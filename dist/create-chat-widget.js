var ChatWidget;(()=>{"use strict";var e={d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{createWidget:()=>r,stopNotification:()=>c});const a="BFimg4nhhiga2UkChbE_luhDsQoQL1_82igq9D9--RMSSVVOsCC1kd4Rc6V2vDcq7Bh0feKWxcvpZpY8eBr4Vhg";let o;async function i(e,t){const i=await async function(e,t){if("serviceWorker"in navigator){const a=await navigator.serviceWorker.register("/360-sw.js");return navigator.serviceWorker.ready.then((a=>{a.active.postMessage({token:e,system:t})})),a}console.log("[chat-embed] No service worker available")}(e,t);console.log(i),i&&await async function(e,t){const i=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:s(a)});o=i;const n={"content-type":"application/json",Authorization:`Bearer ${t}`},r=await fetch("https://auth.swivelsoftware.asia/api/notification/subscribe",{method:"POST",body:JSON.stringify(i),headers:n});r.ok&&console.dir(r)}(i,e),console.log("[chat-embed] service worker registered")}function s(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),a=window.atob(t),o=new Uint8Array(a.length);for(let e=0;e<a.length;++e)o[e]=a.charCodeAt(e);return o}function n(e,t,a,o,i,s){try{!function(e){const t={uat:"https://chat-uat.swivelsoftware.asia/v2/widgets/swivel-chat-widget.js",dev:"https://chat-uat.swivelsoftware.asia/dev-v2/widgets/swivel-chat-widget.js",prod:"https://chat.swivelsoftware.asia/v2/widgets/swivel-chat-widget.js"},a=document.getElementsByTagName("head")[0];let o=document.createElement("script");if(o.type="text/javascript",!t[e])throw new Error("Invalid source version of chat widget: "+e);o.src=t[e],a.appendChild(o)}(s)}catch(e){return void console.error(e)}const n=document.getElementById("chat-container"),r=document.createElement("swivel-chat-widget");r.setAttribute("id","swivel-chat-widget"),r.setAttribute("name",JSON.stringify(["Main"])),r.setAttribute("token",e),r.setAttribute("system",["360uat","360dev"].includes(t)?"360uat":t),r.setAttribute("uat","true"),r.setAttribute("propdata",JSON.stringify({full:!1,button:!0,right:!1,system:["360uat","360dev"].includes(t)?"360uat":t,entityType:"customer",entityKey:a,entityReferenceKey:o,hasPublicChatroom:!0,extraChatrooms:[],maxShowChatroom:6,leftOffset:0,rightOffset:0})),r.setAttribute("injectCss",n.id);const c=document.createElement("style");c.innerHTML=i,n.appendChild(r),r.shadowRoot&&(console.log(c),r.shadowRoot.appendChild(c)),document.body.addEventListener("swivel-widget-loaded",(()=>{r.shadowRoot&&r.shadowRoot.appendChild(c)}))}async function r({username:e,password:t,system:a,entityKey:o,entityReferenceKey:s,overrideCss:r,expireTime:c,widgetSrc:d}){const l=await async function(e,t){const a=await fetch("https://auth.swivelsoftware.asia/auth/local/login",{method:"POST",headers:{"x-system":"360uat","Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,rememberMe:!1})});return(await a.json()).accessToken}(e,t);localStorage.setItem("360-accessToken",l),n(l,a,o,s,r,d),await i(l,a)}async function c(){!async function(){const e={"content-type":"application/json",Authorization:`Bearer ${localStorage.getItem("360-accessToken")}`},t=await fetch("https://auth.swivelsoftware.asia/api/notification/unsubscribe",{method:"POST",body:JSON.stringify(o),headers:e});t.ok&&console.dir(t)}()}ChatWidget=t})();